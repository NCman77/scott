# 智能背誦遮罩工具 v4.1 - 更新說明

## 版本資訊
- **版本號**: v4.1 Enhanced
- **更新日期**: 2026-01-18
- **更新內容**: 新增 Undo/Redo、匯出圖片、自訂顏色、優化圖片載入

---

## 🎉 新功能

### 1. Undo/Redo 功能（復原/重做）

**位置**：左側工具列（新增兩個按鈕）

**使用方法**：
- **復原（Undo）**：點擊「Undo」按鈕或按 `Ctrl+Z`（Mac: `Cmd+Z`）
- **重做（Redo）**：點擊「Redo」按鈕或按 `Ctrl+Y`（Mac: `Cmd+Y`）或 `Ctrl+Shift+Z`

**支援操作**：
- 新增遮罩（方框/筆刷）
- AI 偵測自動新增遮罩
- 清除所有遮罩

**限制**：
- 最多記錄 50 個操作
- 切換頁面時會清空歷史記錄

**視覺回饋**：
- 按鈕會根據是否可操作自動啟用/停用（灰色）

---

### 2. 匯出圖片功能

**位置**：Header（「儲存 | Save」按鈕旁）

**使用方法**：
1. 選擇要匯出的頁面
2. 點擊「匯出 | Export」按鈕
3. 圖片會自動下載為 PNG 格式

**檔案命名**：`原檔名_annotated_日期.png`
- 例如：`exam01_annotated_20260118.png`

**說明**：
- 匯出的圖片包含原圖 + 所有可見的遮罩
- **與「儲存 | Save」的區別**：
  - **儲存 (Save)**：匯出 JSON 專案檔案（可重新編輯）
  - **匯出 (Export)**：匯出最終成品圖片（不可編輯）

---

### 3. 自訂顏色選擇器

**位置**：左側工具列顏色選擇區（最下方）

**識別**：彩虹漸層背景 + 調色盤圖示 🎨

**使用方法**：
1. 點擊彩虹顏色方塊
2. 會彈出系統顏色選擇器
3. 選擇任意顏色
4. 筆刷和方框會使用選擇的顏色

**預設顏色保留**：
- 黑色 #44403c
- 紅色 #ef4444
- 藍色 #3b82f6
- 綠色 #22c55e
- 白色 #ffffff

---

### 4. 圖片自動適應視窗

**改進**：載入圖片時自動縮放至適應視窗大小

**行為**：
- **之前**：載入圖片後可能需要手動調整縮放
- **現在**：載入後自動執行「Fit」功能，確保整張圖片可見

**手動調整**：
- 依然可以使用縮放控制（右下角）進行手動調整
- `+`：放大
- `-`：縮小
- `Fit`：適應視窗

---

## 🔧 改進項目

### 縮放控制優化
- **問題**：使用者反應只看到「+」按鈕
- **解決方案**：檢查並確認所有按鈕（+、-、Fit、100%）都正確顯示
- **CSS 確認**：z-index 和定位已優化

---

## 📂 檔案清單

### 主要檔案（3個）
1. **index.html** - HTML 結構（新增 Undo/Redo 按鈕、匯出按鈕、自訂顏色選擇器）
2. **styles.css** - 樣式表（新增自訂顏色樣式）
3. **app.js** - 主程式（整合所有新功能）

### 模組檔案（已建立，備用）
- `src/utils/config.js` - 設定常數
- `src/utils/crypto.js` - 加密工具
- `src/utils/validation.js` - 驗證工具
- `src/utils/image.js` - 圖片處理
- `src/commands/command-manager.js` - Undo/Redo 指令系統
- `src/storage/indexed-db.js` - IndexedDB 儲存（未來整合）

**說明**：目前所有功能已整合到 `app.js` 單檔中，保持部署簡便性。模組檔案作為未來擴展的基礎。

---

## 🎮 快捷鍵一覽

| 按鍵 | 功能 | 新增 |
|------|------|------|
| `V` | 切換到瀏覽模式 | |
| `R` | 切換到方框工具 | |
| `B` | 切換到筆刷工具 | |
| `E` | 切換到擦除工具 | |
| `Ctrl+Z` | 復原（Undo） | ✅ |
| `Ctrl+Y` / `Ctrl+Shift+Z` | 重做（Redo） | ✅ |
| `←` | 上一頁 | |
| `→` | 下一頁 | |
| `Esc` | 退出全螢幕 | |

---

## 🧪 測試指南

### 測試 1：Undo/Redo
1. 匯入一張圖片
2. 使用筆刷繪製一個遮罩 → 檢查「Undo」按鈕是否可點擊
3. 點擊「Undo」→ 檢查遮罩是否消失
4. 點擊「Redo」→ 檢查遮罩是否重新出現
5. 繪製多個遮罩，連續按 Ctrl+Z → 檢查是否逐一復原
6. ✅ **成功**：所有遮罩操作都能正確復原和重做

### 測試 2：匯出圖片
1. 匯入圖片並新增遮罩
2. 點擊「匯出 | Export」按鈕
3. 檢查下載的 PNG 檔案
4. 用圖片查看器開啟
5. ✅ **成功**：圖片包含原圖和所有遮罩

### 測試 3：自訂顏色
1. 點擊彩虹顏色方塊（調色盤圖示）
2. 選擇紫色（#8b5cf6）
3. 使用筆刷繪製
4. ✅ **成功**：遮罩顯示為紫色

### 測試 4：圖片自動適應
1. 匯入一張大圖片（例如 2000x3000 px）
2. 檢查圖片是否自動縮放
3. ✅ **成功**：整張圖片可見，無需手動調整

### 測試 5：縮放控制
1. 檢查右下角縮放控制
2. ✅ **成功**：應看到「+」、「100%」、「-」、「Fit」四個按鈕垂直排列

---

## 📱 瀏覽器相容性

**已測試**：
- Chrome 90+
- Edge 90+
- Safari 14+（Mac/iPad）
- Firefox 88+

**建議**：
- 使用最新版 Chrome 或 Edge 以獲得最佳體驗
- 行動裝置建議使用 Safari（iOS）或 Chrome（Android）

---

## 🐛 已知問題 / 未來計劃

### 已知問題
無

### 未來計劃
1. **批次匯出**：一鍵匯出所有頁面為 ZIP
2. **IndexedDB 整合**：支援大型專案（超過 10MB）
3. **PWA 支援**：可安裝為離線應用程式
4. **筆刷滑桿優化**：點擊數值即彈出（不需雙擊）
5. **TypeScript 遷移**：提升程式碼品質

---

## 💡 使用建議

### 工作流程推薦
1. **匯入試卷**：批量選擇多張圖片
2. **AI 偵測**：自動標註手寫區域
3. **手動補充**：使用筆刷/方框補充遺漏
4. **自訂顏色**：用不同顏色區分重點
5. **儲存專案**：定期儲存 JSON 檔案（可重新編輯）
6. **匯出圖片**：完成後匯出 PNG（最終成品）

### 快捷鍵組合技
- **快速復原**：繪製3個遮罩 → 連按3次 Ctrl+Z → 全部消除
- **重複操作**：Ctrl+Z → Ctrl+Y → 復原後重做（用於檢查）
- **換頁+繪製**：→（下一頁）→ B（筆刷）→ 繪製 → → → 連續作業

---

## 📞 回報問題

如發現任何問題，請提供以下資訊：
1. 瀏覽器版本
2. 操作步驟
3. 錯誤訊息（如有）
4. 瀏覽器 Console 截圖（按 F12）

---

**版權宣告**：MIT License  
**作者**：Smart Mask Tool Team  
**最後更新**：2026-01-18
